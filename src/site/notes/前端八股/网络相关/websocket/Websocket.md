---
{"dg-publish":true,"permalink":"/前端八股/网络相关/websocket/Websocket/","created":"2025-05-25T12:59:33.708+08:00","updated":"2025-06-15T13:14:04.443+08:00"}
---


> [!NOTE]
> 提炼：websocket是一种基于TCP连接的全双工实时通信协议，可以在客户端和服务端之间建立持久化连接。客户端向服务器发送一个 WebSocket 握手请求，服务器响应一个握手响应，连接就被建立了。一旦连接建立，客户端和服务器就可以在连接上互相发送数据，直到其中一方发送一个关闭帧来关闭连接。 WebSocket 本身**没有自动探测连接断开的机制**，所以需要设置心跳机制来保持连接，客户端定时发送ping，服务端收到恢复pong。

### 一、  简介

#### 1.1 什么是WebSocket

WebSocket是一种协议，用于在Web应用程序和服务器之间建立实时、[双向的](https://so.csdn.net/so/search?q=%E5%8F%8C%E5%90%91%E7%9A%84&spm=1001.2101.3001.7020)通信连接。它通过一个单一的TCP连接提供了持久化连接，这使得Web应用程序可以更加实时地传递数据。WebSocket协议最初由W3C开发，并于2011年成为标准。

#### 1.2 WebSocket的优势和劣势

**WebSocket的优势包括：**

- **实时性：** 由于WebSocket的持久化连接，它可以实现实时的数据传输，避免了Web应用程序需要不断地发送请求以获取最新数据的情况。
    
- **双向通信：** WebSocket协议支持双向通信，这意味着服务器可以主动向客户端发送数据，而不需要客户端发送请求。
    
- **减少网络负载：** 由于WebSocket的持久化连接，它可以减少HTTP请求的数量，从而减少了网络负载。
    

**WebSocket的劣势包括：**

- **需要浏览器和服务器都支持：** WebSocket是一种相对新的技术，需要浏览器和服务器都支持。一些旧的浏览器和服务器可能不支持WebSocket。
    
- **需要额外的开销：** WebSocket需要在服务器上维护长时间的连接，这需要额外的开销，包括内存和CPU。
    
- **安全问题：** 由于WebSocket允许服务器主动向客户端发送数据，可能会存在安全问题。服务器必须保证只向合法的客户端发送数据。
    

### 二、 WebSocket的基本概念

#### 2.1 WebSocket的协议

[WebSocket 协议](https://so.csdn.net/so/search?q=WebSocket%20%E5%8D%8F%E8%AE%AE&spm=1001.2101.3001.7020)是一种基于TCP的协议，用于在客户端和服务器之间建立持久连接，并且可以在这个连接上实时地交换数据。WebSocket协议有自己的握手协议，用于建立连接，也有自己的数据传输格式。

当客户端发送一个 WebSocket 请求时，服务器将发送一个协议响应以确认请求。在握手期间，客户端和服务器将协商使用的协议版本、支持的子协议、支持的扩展选项等。一旦握手完成，连接将保持打开状态，客户端和服务器就可以在连接上实时地传递数据。

WebSocket 协议使用的是双向数据传输，即客户端和服务器都可以在任意时间向对方发送数据，而不需要等待对方的请求。它支持二进制数据和文本数据，可以自由地在它们之间进行转换。

总之，WebSocket协议是一种可靠的、高效的、双向的、持久的通信协议，它适用于需要实时通信的Web应用程序，如在线游戏、实时聊天等。

#### 2.2 WebSocket的生命周期

WebSocket 生命周期描述了 WebSocket 连接从创建到关闭的过程。一个 WebSocket 连接包含以下四个主要阶段：

- **连接建立阶段（Connection Establishment）：** 在这个阶段，客户端和服务器之间的 WebSocket 连接被建立。客户端发送一个 WebSocket 握手请求，服务器响应一个握手响应，然后连接就被建立了。
    
- **连接开放阶段（Connection Open）：** 在这个阶段，WebSocket 连接已经建立并开放，客户端和服务器可以在连接上互相发送数据。
    
- **连接关闭阶段（Connection Closing）：** 在这个阶段，一个 WebSocket 连接即将被关闭。它可以被客户端或服务器发起，通过发送一个关闭帧来关闭连接。
    
- **连接关闭完成阶段（Connection Closed）：** 在这个阶段，WebSocket 连接已经完全关闭。客户端和服务器之间的任何交互都将无效。
    

> “
> 
> 需要注意的是，WebSocket 连接在任何时候都可能关闭，例如网络故障、服务器崩溃等情况都可能导致连接关闭。因此，需要及时处理 WebSocket 连接关闭的事件，以确保应用程序的可靠性和稳定性。

下面是一个简单的 WebSocket 生命周期示意图：

![图片](https://i-blog.csdnimg.cn/blog_migrate/52fc058e72b460c21aaabee1551d0a97.jpeg)

图片

在这个示意图中，<mark style="background: #FFB86CA6;">客户端向服务器发送一个 WebSocket 握手请求，服务器响应一个握手响应，连接就被建立了。一旦连接建立，客户端和服务器就可以在连接上互相发送数据，直到其中一方发送一个关闭帧来关闭连接</mark>。在关闭帧被接收后，连接就会被关闭，WebSocket 连接关闭完成。

#### 2.3 WebSocket的消息格式

WebSocket 的消息格式与 HTTP 请求和响应的消息格式有所不同。WebSocket 的消息格式可以是文本或二进制数据，并且 WebSocket 消息的传输是在一个已经建立的连接上进行的，因此不需要再进行 HTTP 请求和响应的握手操作。

WebSocket 消息格式由两个部分组成：消息头和消息体。

消息头包含以下信息：

- **FIN：** 表示这是一条完整的消息，一般情况下都是1。
    
- **RSV1、RSV2、RSV3：** 暂时没有使用，一般都是0。
    
- **Opcode：** 表示消息的类型，包括文本消息、二进制消息等。
    
- **Mask：** 表示消息是否加密。
    
- **Payload length：** 表示消息体的长度。
    
- **Masking key：** 仅在消息需要加密时出现，用于对消息进行解密。
    

消息体就是实际传输的数据，可以是文本或二进制数据。

[轮询与websocket](websocket/轮询与websocket.md)
[前端实时通信的8种方式及其优缺点和实现方式-websocket延时-CSDN博客](前端实时通信的8种方式及其优缺点和实现方式-websocket延时-CSDN博客.md)