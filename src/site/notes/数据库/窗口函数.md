---
{"dg-publish":true,"permalink":"/数据库/窗口函数/","created":"2024-07-12T16:53:39.504+08:00","updated":"2025-06-14T22:18:47.609+08:00"}
---

窗口函数（Window Function）是SQL中的一种特殊类型的函数，它们在查询结果集中对数据行执行计算，但是与聚合函数（如SUM、COUNT等）不同，窗口函数不会将多行合并为一行。窗口函数允许您在不改变原始数据集的行数的情况下，对数据集的行进行分组和计算。

窗口函数的关键特点包括：

1. **OVER子句**：
   - 窗口函数通常与OVER子句一起使用，OVER子句定义了窗口函数操作的窗口范围，即数据的子集。

2. **分区**：
   - 窗口函数允许您通过PARTITION BY子句对数据进行分区（partitioning），每个分区内的数据将独立地应用窗口函数。

3. **排序**：
   - 通过ORDER BY子句在OVER中定义数据的排序顺序，这决定了窗口内行的顺序。

4. **框架定义**：
   - 窗口函数可以使用框架定义（frame clause），它指定了窗口内包含哪些行。例如，它可以是固定数量的行，或者是相对于当前行的相对位置。

5. **常见窗口函数**：
   - 一些常见的窗口函数包括ROW_NUMBER()、RANK()、DENSE_RANK()、LEAD()、LAG()、SUM()、AVG()等。

6. **用途**：
   - 窗口函数用于执行如行号分配、数据透视、时间序列分析、比较当前行与前后行的数据等操作。

7. **数据库支持**：
   - 窗口函数在许多现代数据库系统中得到支持，包括Oracle、SQL Server、PostgreSQL、MySQL 8.0+等。

以下是一个使用窗口函数的SQL查询示例：

```sql
SELECT 
    employee_id,
    department_id,
    salary,
    RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) AS salary_rank
FROM 
    employees;
```

这个查询将为`employees`表中的每个员工根据其部门和工资等级分配一个排名。每个部门的工资最高者将获得排名1，如果存在工资相同的情况，则会并列排名（例如，两个最高工资者都将是1，接下来的排名将会是3，跳过2）。

窗口函数是进行复杂数据分析的强大工具，它们提供了一种灵活的方式来处理数据，而无需改变原始数据集的结构。
